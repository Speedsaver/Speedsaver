# Minimal SD card image for the OrangePi Zero
#
image uboot.vfat {
	vfat {
		files = {
			"boot.scr"
		}
	}
	size = 1M
}

image data.vfat {
	vfat {
		label = "DATA"
	}
	empty = "true"
	size = 110M
}

image sdcard-${GENIMAGE_BUILD_ID}.img {
	hdimage {
		gpt = "true"
	}

	partition u-boot {
		in-partition-table = "no"
		image = "u-boot-sunxi-with-spl.bin"
		offset = 128K
		size = 1040384 # 1MB - 8192
	}

	partition data {
		partition-type = 0xC
		image = "data.vfat"
	}

	partition boot {
		partition-type = 0xC
		image = "uboot.vfat"
	}

	partition PrimaryRootfs {
		partition-type = 0x83
		image = "rootfs.ext4"
		bootable = "true"
	}

	partition SecondaryRootfs {
		partition-type = 0x83
		image = "rootfs.ext4"
		bootable = "true"
	}
}

image bundle-Speedsaver.${GENIMAGE_BUILD_ID}.raucb {
	name = "bundle-Speedsaver-${GENIMAGE_BUILD_ID}"
	rauc {
		files = {
			"uboot.vfat",
			"rootfs.tar.xz"
		}
		key = "${BR2_EXTERNAL_SPEEDSAVER_PATH}/certs/signing.key"
		cert = "${BR2_EXTERNAL_SPEEDSAVER_PATH}/certs/signing.crt"
		extraargs = "--keyring ${BR2_EXTERNAL_SPEEDSAVER_PATH}/certs/keyring.pem"
		manifest = 
			"[update]
			compatible=Speedsaver Orange Pi Zero
			version=${GENIMAGE_BUILD_ID}
			description=RAUC bundle for Speedsaver Orange Pi Zero version ${GENIMAGE_BUILD_ID}, built by ${GENIMAGE_USER}@${GENIMAGE_HOST}.
			[image.uboot]
			filename=uboot.vfat
			[image.rootfs]
			filename=rootfs.tar.xz"
	}
}
